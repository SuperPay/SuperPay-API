
# SuperPay API

[Chinese Version](./README_CN.md)

SuperPay API provides an easy-to-use, powerful and secure online payment method to accept Bitcoin, USDT, Ethereum and other cryptocurrencies [MORE](https://www.superpay.one)


## Overview

1. Create order interface.
2. Verify that the request is legal.
3. When the order status changes, SuperPay will push the corresponding notification.
4. Can query the order payment status asynchronously.

## Authorization
Go to the [SuperPay](https://www.superpay.one) to get the merchant ID and key to access the SuperPay API.


## API

#### Exchange Rate

Get the exchange rate of the cryptocurrency and legal currency supported by the system. This interface is public and does not require authentication.


```
POST https://www.superpay.one/app/api/demo/coin2cny
```

##### Request

|Field|Type|Required|Description|
|----|---|---|---|
|coin|string|NO|Currency symbol. Example: BTC|

Note: Returns the exchange rate of cryptocurrency and legal currency supported by all systems if not passed

##### Response

```json
{
    "status":1,
    "msg":"",
    "data":[
        {
            "coin":"btc",
            "value":"35163.97"
        },
        {
            "coin":"eth",
            "value":"1138.35"
        }
    ]
}
```

#### Create Order

Create an order record and return the order data.

```
POST https://www.superpay.one/app/api/demo/order
```

##### Request

|Field|Type|Required|Description|
|----|---|---|---|
|mch_id|integer|YES|SuperPay Business ID|
|out_trade_no|string|YES|Merchant system internal order number|
|coin|string|YES|Cryptographic currency, e: USDT, ETH, BTC|
|amount|double|YES|Amount of legal currency. e: 100.2|
|info|string|NO|Note|
|sign|string|Yes|See Signature Algorithm for details.|

#### Response

```json
{
    "status":1,
    "msg":"Success",
    "data":{
        "trade_no":"190413152811ethDemorKU5hd5eSD",
        "out_trade_no":"a0015482ebcddd",
        "address":"0xe33b5c1bc3b4c10967bb57b40b9574ea1e40c529",
        "coin":"eth",
        "num":"0.00087893",
        "fee":0,
        "cny":1,
        "info":"",
        "status":0,
        "addtime":1555140491
    }
}
```

### Query order status

Invoking the order payment status asynchronously by the order number trade_no obtained when the order was submitted.


```
POST https://www.superpay.one/app/api/demo/trade_status
```

##### Request

|Field|Type|Required|Description|
|----|---|---|---|
|mch_id|integer|YES|SuperPay Business ID|
|trade_no|string|YES|Order number generated by the platform|
|coin|string|YES|Cryptographic currency, e: USDT, ETH, BTC|
|sign|string|YES|See Signature Algorithm for details.|

#### Response

```json
{
    "status":1,
    "trade_no":"190413153712usdtDemofExlkITPBK",
    "coin":"eos",
    "num":1.0000,
    "deal":1.0000,
    "addtime":1555140491,
    "updatetime":1555140521,
    "msg":"Pay1 EOS"
}
```

### <a name="signature">Signature</a>

The merchant's backend program and SuperPay create the same signature based on the same key and algorithm to verify each other's identity.

#### Step

1. Let all the data sent or received be the set M, and sort the parameters of the non-empty parameter values in the set M according to the parameter name ASCII code from small to large (dictionary order), using the format of the URL key-value pair (ie key1=value1&key2=value2) ...) stitched into a string stringA

    Important Rules:

    * The parameter name ASCII code is sorted from small to large (dictionary order);
    * If the value of the parameter is null, do not participate in the signature;
    * Parameter names are case sensitive;
    * When the verification call returns or the SuperPay actively notifies the signature, the transmitted sign parameter does not participate in the signature, and the generated signature is checked against the sign value.

2. In the last stitching of stringA, the key gets the stringSignTemp string, and performs MD5 operation on stringSignTemp, and then converts all the characters of the obtained string into uppercase, and gets the sign value signValue.


#### Example

Assume that the parameters transmitted are as follows:


```
mch_id: 10001 
trade_no: 190413153712usdtDemofExlkITPBK
info: abcd
```

The first step is to sort the parameters according to the key=value format and sort them according to the parameter name ASCII dictionary order as follows:

```
stringA="info=abcd&mch_id=10001&trade_no=190413153712usdtDemofExlkITPBK";
```

The second step: splicing the API key:

```
stringSignTemp="stringA&key=spay20191245785412gegscseook24" 
sign=MD5(stringSignTemp)
```
